<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>React Editor Pro</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone@7.23.6/babel.min.js"></script>

    <style>
        /* CRITICAL: Prevent overscroll/bouncing on mobile */
        html, body {
            height: 100%;
            width: 100%;
            overflow: hidden;
            overscroll-behavior: none;
            -webkit-tap-highlight-color: transparent;
            background-color: #0f172a; /* Slate 900 */
        }
        
        /* Font Settings */
        .editor-font {
            font-family: 'SF Mono', 'Menlo', 'Monaco', 'Courier New', monospace;
            font-size: 14px;
            line-height: 24px;
        }
        
        /* Prevent iOS Zoom on focus by using 16px on mobile, but keep layout tight */
        @media (max-width: 768px) {
            .editor-font {
                font-size: 16px; 
                line-height: 24px; 
            }
        }

        /* Scrollbars */
        ::-webkit-scrollbar { width: 4px; height: 4px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 2px; }

        /* Inputs */
        textarea {
            caret-color: #38bdf8;
            resize: none;
            outline: none;
        }
        
        /* Spinner */
        .loader {
            border: 2px solid rgba(255,255,255,0.1);
            border-top-color: #38bdf8;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            animation: spin 0.8s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <!-- 
        FIXED HEADER 
    -->
    <header class="fixed top-0 left-0 right-0 h-14 bg-slate-900 border-b border-slate-800 flex items-center justify-between px-3 z-50 shadow-sm">
        <div class="flex items-center gap-3">
            <div class="w-8 h-8 bg-sky-500/10 rounded-lg flex items-center justify-center border border-sky-500/20 text-sky-500 font-bold select-none">
                âš›
            </div>
            <div>
                <h1 class="font-bold text-white text-sm leading-tight select-none">React<span class="text-sky-500">Pad</span></h1>
            </div>
        </div>
        
        <!-- Top Controls -->
        <div class="flex items-center gap-1">
            <button onclick="toggleSearch()" class="p-2 rounded-lg hover:bg-slate-800 text-slate-400 transition" title="Find">
                <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
            </button>
            <button onclick="runAndShow()" class="md:hidden flex items-center gap-2 bg-sky-600 hover:bg-sky-500 text-white px-3 py-1.5 rounded-lg text-xs font-bold transition ml-2">
                <span id="mobile-run-text">Run</span>
            </button>
            <button onclick="runCode()" class="hidden md:flex items-center gap-2 bg-sky-600 hover:bg-sky-500 text-white px-4 py-1.5 rounded-lg text-xs font-bold transition ml-2">
                Run
            </button>
        </div>
    </header>

    <!-- 
        SEARCH BAR (Fixed Overlay)
    -->
    <div id="search-bar" class="hidden fixed top-14 left-0 right-0 h-12 bg-[#0b1221] border-b border-sky-900/50 flex items-center px-2 gap-2 z-40 shadow-xl">
        <input id="search-input" type="text" placeholder="Find..." class="flex-1 bg-slate-800 text-sm text-white px-3 py-1.5 rounded border border-slate-700 focus:border-sky-500 outline-none transition" onkeydown="if(event.key === 'Enter') findNext(true)">
        <span id="search-count" class="text-[10px] text-slate-500 font-mono w-12 text-center select-none">0/0</span>
        <button onclick="findNext(false)" class="p-1.5 bg-slate-800 hover:bg-slate-700 rounded text-slate-300 border border-slate-700"><svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="m18 15-6-6-6 6"/></svg></button>
        <button onclick="findNext(true)" class="p-1.5 bg-slate-800 hover:bg-slate-700 rounded text-slate-300 border border-slate-700"><svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="m6 9 6 6 6-6"/></svg></button>
        <button onclick="toggleSearch()" class="p-1.5 hover:text-red-400 text-slate-500"><svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg></button>
    </div>

    <!-- 
        MAIN CONTENT 
    -->
    <main class="w-full h-full pt-14 flex overflow-hidden">
        
        <!-- EDITOR PANE -->
        <div id="editor-pane" class="w-full md:w-1/2 h-full flex flex-col relative bg-slate-950 border-r border-slate-800">
            
            <!-- File Info Bar -->
            <div class="h-8 bg-[#0b1221] border-b border-slate-800 flex items-center px-4 justify-between shrink-0 select-none">
                <span class="text-xs text-slate-400 font-mono flex items-center gap-2">
                    <svg width="10" height="10" fill="currentColor" viewBox="0 0 24 24"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"/></svg>
                    App.js
                </span>
                <span id="status" class="text-[10px] text-slate-600 font-mono uppercase">Idle</span>
            </div>

            <!-- Code Area Wrapper -->
            <div class="flex-1 flex relative overflow-hidden">
                <!-- Line Numbers -->
                <div id="line-numbers" class="w-10 bg-slate-900 border-r border-slate-800 text-slate-600 text-right pr-2 pt-4 select-none editor-font overflow-hidden cursor-default">
                    1
                </div>
                <!-- Textarea -->
                <textarea 
                    id="code-editor" 
                    class="flex-1 bg-[#0f172a] text-slate-300 p-4 pt-4 border-none outline-none editor-font whitespace-pre overflow-auto"
                    spellcheck="false" 
                    autocorrect="off" 
                    autocapitalize="off"
                    wrap="off"
                    placeholder="// Write your React code here...
// Don't forget to export default function App() {}"
                ></textarea>
            </div>
        </div>

        <!-- PREVIEW PANE -->
        <div id="preview-pane" class="fixed inset-0 top-0 left-0 w-full h-full md:static md:w-1/2 bg-white z-[60] translate-y-full md:translate-y-0 transition-transform duration-300 flex flex-col">
            
            <!-- Preview Header -->
            <div class="h-14 md:h-8 bg-gray-50 border-b border-gray-200 flex items-center justify-between px-4 shrink-0 shadow-sm md:shadow-none">
                <span class="text-sm font-bold text-gray-700 md:text-xs md:text-gray-500 md:uppercase">Preview</span>
                <div class="flex items-center gap-3">
                    <div id="spinner" class="loader hidden"></div>
                    <button onclick="togglePreview()" class="md:hidden bg-gray-200 text-gray-700 px-3 py-1 rounded text-xs font-bold active:scale-95 transition">
                        Close
                    </button>
                </div>
            </div>

            <!-- Iframe -->
            <div class="flex-1 relative bg-white w-full">
                <iframe id="preview-frame" class="w-full h-full border-none" sandbox="allow-scripts allow-same-origin allow-modals"></iframe>
                
                <!-- Error Overlay -->
                <div id="error-overlay" class="hidden absolute inset-0 bg-white/95 backdrop-blur-sm p-6 overflow-auto z-10">
                    <div class="p-4 bg-red-50 border-l-4 border-red-500 rounded-r shadow-sm">
                        <h3 class="text-red-800 font-bold mb-2 text-sm flex items-center gap-2">
                            <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
                            Error
                        </h3>
                        <pre id="error-message" class="text-xs font-mono text-red-700 whitespace-pre-wrap break-all"></pre>
                    </div>
                    <button onclick="togglePreview()" class="md:hidden mt-4 text-sm text-gray-500 underline">Back to Code</button>
                </div>
            </div>
        </div>
    </main>

    <script>
        // --- NO DEFAULT CODE ---
        // The user must type code to see results.
        
        // --- ELEMENTS ---
        const els = {
            editor: document.getElementById('code-editor'),
            lineNums: document.getElementById('line-numbers'),
            searchBar: document.getElementById('search-bar'),
            searchInput: document.getElementById('search-input'),
            searchCount: document.getElementById('search-count'),
            previewPane: document.getElementById('preview-pane'),
            frame: document.getElementById('preview-frame'),
            errorOverlay: document.getElementById('error-overlay'),
            errorMsg: document.getElementById('error-message'),
            status: document.getElementById('status'),
            spinner: document.getElementById('spinner'),
            mobileRunText: document.getElementById('mobile-run-text')
        };

        // --- STATE ---
        let matches = [];
        let currentMatchIdx = -1;
        let dbTimer = null;

        // --- INIT ---
        window.onload = () => {
            // Load saved code, OR empty string if nothing saved.
            const saved = localStorage.getItem('reactpad_empty_v1');
            els.editor.value = saved || ''; 
            updateLineNumbers();
            
            // Only run code if there is something saved.
            // If empty, we stay idle to avoid showing errors on first load.
            if(saved && saved.trim() !== '' && window.innerWidth >= 768) {
                runCode();
            }
        };

        // --- EDITOR LOGIC ---
        
        function updateLineNumbers() {
            const lines = els.editor.value.split('\n').length;
            if (els.lineNums.childElementCount !== lines) {
                els.lineNums.innerHTML = Array(lines).fill(0).map((_, i) => `<div>${i + 1}</div>`).join('');
            }
        }

        function syncScroll() {
            els.lineNums.scrollTop = els.editor.scrollTop;
        }

        els.editor.addEventListener('input', () => {
            updateLineNumbers();
            localStorage.setItem('reactpad_empty_v1', els.editor.value);
            els.status.innerText = "Unsaved";
            
            // Auto-run on desktop if there is code
            if(window.innerWidth >= 768) {
                clearTimeout(dbTimer);
                if (els.editor.value.trim() !== '') {
                    dbTimer = setTimeout(runCode, 1000);
                }
            }
        });

        els.editor.addEventListener('scroll', syncScroll);
        
        // Handle Tab key
        els.editor.addEventListener('keydown', (e) => {
            if (e.key === 'Tab') {
                e.preventDefault();
                document.execCommand('insertText', false, '  ');
            }
        });

        // --- SEARCH FEATURE ---
        window.toggleSearch = () => {
            const isHidden = els.searchBar.classList.contains('hidden');
            if (isHidden) {
                els.searchBar.classList.remove('hidden');
                els.searchBar.classList.add('flex');
                setTimeout(() => els.searchInput.focus(), 50);
            } else {
                els.searchBar.classList.add('hidden');
                els.searchBar.classList.remove('flex');
                els.editor.focus();
            }
        };

        window.findNext = (forward) => {
            const query = els.searchInput.value;
            if (!query) return;

            const text = els.editor.value;
            matches = [];
            let regex = new RegExp(query.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'gi'); 
            let match;
            while ((match = regex.exec(text)) !== null) {
                matches.push({ start: match.index, end: match.index + query.length });
            }

            if (matches.length === 0) {
                els.searchCount.innerText = "0/0";
                return;
            }

            if (forward) {
                currentMatchIdx = (currentMatchIdx + 1) % matches.length;
            } else {
                currentMatchIdx = (currentMatchIdx - 1 + matches.length) % matches.length;
            }

            els.searchCount.innerText = `${currentMatchIdx + 1}/${matches.length}`;
            const m = matches[currentMatchIdx];
            
            els.editor.focus();
            els.editor.setSelectionRange(m.start, m.end);
            
            const textBefore = text.substring(0, m.start);
            const lineNum = textBefore.split('\n').length;
            const scrollPos = (lineNum * 24) - 100; 
            
            els.editor.scrollTo({
                top: scrollPos,
                behavior: 'smooth'
            });
        };


        // --- PREVIEW & RUN LOGIC ---

        window.togglePreview = () => {
            els.previewPane.classList.toggle('translate-y-full');
        };

        window.runAndShow = async () => {
            // Check if empty before running to avoid confusion
            if (els.editor.value.trim() === '') {
                alert("Please enter some React code first!\nExample: export default function App() { return <h1>Hello</h1> }");
                return;
            }

            els.mobileRunText.innerText = "Building...";
            els.spinner.classList.remove('hidden');
            
            setTimeout(() => {
                runCode();
                els.previewPane.classList.remove('translate-y-full'); 
                els.mobileRunText.innerText = "Run";
                els.spinner.classList.add('hidden');
            }, 50);
        };

        function runCode() {
            els.status.innerText = "Building...";
            els.errorOverlay.classList.add('hidden');

            const rawCode = els.editor.value;

            // If empty, do nothing
            if (!rawCode.trim()) {
                els.status.innerText = "Idle";
                return;
            }
            
            // Clean imports
            const cleanCode = rawCode.replace(/import\s+.*?from\s+['"].*?['"];?/g, '');
            
            // Handle Export Default
            let runnable = cleanCode
                .replace(/export\s+default\s+function\s*(\w*)/, 'window.App = function $1')
                .replace(/export\s+default\s+class\s*(\w*)/, 'window.App = class $1')
                .replace(/export\s+default\s+/, 'window.App = ');

            try {
                const js = Babel.transform(runnable, { presets: ['react', 'env'] }).code;
                
                const html = `
                    <!DOCTYPE html>
                    <html lang="en">
                    <head>
                        <meta name="viewport" content="width=device-width, initial-scale=1.0">
                        <script src="https://cdn.tailwindcss.com"><\/script>
                        <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"><\/script>
                        <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"><\/script>
                        <style>body{overscroll-behavior:none;}</style>
                    </head>
                    <body>
                        <div id="root"></div>
                        <script>
                            window.onerror = (m) => window.parent.postMessage({type:'ERR', msg:m}, '*');
                            window.React = React;
                            window.useState = React.useState;
                            window.useEffect = React.useEffect;
                            window.useRef = React.useRef;
                            try {
                                ${js}
                                const root = ReactDOM.createRoot(document.getElementById('root'));
                                if(window.App) root.render(React.createElement(window.App));
                                else throw new Error("No 'export default' found. Please export your main component.");
                            } catch(e) {
                                window.parent.postMessage({type:'ERR', msg:e.message}, '*');
                            }
                        <\/script>
                    </body>
                    </html>
                `;
                
                const blob = new Blob([html], {type: 'text/html'});
                els.frame.src = URL.createObjectURL(blob);
                els.status.innerText = "Ready";

            } catch (err) {
                els.errorMsg.innerText = err.message;
                els.errorOverlay.classList.remove('hidden');
                els.status.innerText = "Error";
            }
        }

        window.addEventListener('message', (e) => {
            if(e.data?.type === 'ERR') {
                els.errorMsg.innerText = e.data.msg;
                els.errorOverlay.classList.remove('hidden');
            }
        });
    </script>
</body>
</html>


